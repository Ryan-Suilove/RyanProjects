
# 微调 A 同学语气对话机器人 - 项目笔记

## 1. 项目目标
- 微调一个对话机器人，使其在和用户对话时，能够**模仿 A 同学的语气、表达风格**。
- 数据来源：群聊记录（TXT 格式），包含 A 同学和其他人多人的发言。
- 输出：可用于 SFT / LoRA 微调的 JSON 格式训练数据集。

---

## 2. 数据清洗与训练集构造

### 2.1 JSON 结构
- 使用 **instruction / input / output** 三元组结构：
```json
{
  "instruction": "你现在模仿A（QQ号：1969608958）的语气回答。",
  "input": "上下文（清洗后的消息）",
  "output": "A的发言"
}
```

- **input**：前几条上下文消息（经过清洗，去掉无意义符号/表情/@别人）。
- **output**：A 同学的真实发言。

### 2.2 原始群聊特点与问题
- 群聊是多线程、多人交叉的对话：
  - 固定取前两条消息可能抓到不相关的上下文。
  - 含有图片、表情、@别人等无意义内容。
  - 用户名可能含特殊字符或 emoji，需要正则兼容。

### 2.3 数据清洗策略
1. **过滤无意义内容**
   - 图片、表情符号、纯符号（`/`、`@`等）。
2. **上下文筛选**
   - 只保留 A 或提到 A 的消息。
   - 可加时间间隔限制（如 3 分钟内）。
3. **清洗 input / output**
   - input 去掉噪声，保留语义和上下文。
   - output 保留 A 的风格特征（口头禅、符号、表情）。
4. **Unicode 兼容**
   - 用户名可能含 emoji，需要正则支持 Unicode。

---

## 3. 脚本设计与实现

### 3.1 原则
- 逐行读取 TXT 文件（大文件无需加载到编辑器）。
- 解析格式：
```
YYYY-MM-DD HH:MM:SS 用户名(QQ号)
消息正文
```
- 支持 emoji / 特殊字符。
- 生成 JSON 训练集。

### 3.2 可选改进
- 上下文筛选规则：用户过滤 + 时间间隔。
- 高级：embedding 语义匹配，选择与 output 语义相关的上下文。
- 批量 AI 清洗 input：利用 GPT/Gemini 提升上下文相关性。

---

## 4. 数据量分析
- 清洗后保守估计有 5000-6000 条 A 的有效消息。
- 对 SFT 微调来说足够学到语气、表达风格、口头禅、符号习惯。
- 核心在于：
  1. 数据干净  
  2. 上下文相关  
  3. 保留 A 的特色表达

---

## 5. AI 辅助清洗
- 可以利用 GPT/Gemini 对 JSON 批量处理：
  - 清理 input 上下文
  - 删除无意义符号和干扰信息
  - 保留 output 原样
- 分批处理（100-500 条/批）更稳定。
- 面试角度：完全合理，体现数据工程能力，不算取巧。

---

## 6. 下一步计划
1. 优化 JSON 数据集：
   - 清理上下文
   - 保留 A 风格
2. 分批利用 AI 进行批量清洗。
3. 准备微调 LoRA / QLoRA 训练。
4. 验证训练样本效果。

---

## 7. 注意事项
- 保持 A 的个性化符号和口头禅。
- 避免上下文包含无关多线程信息。
- 对大文件不要直接用编辑器打开，可用 Python 逐行读取。
